name: Changesets Renovate

on:
  merge_group:
  pull_request_target:
    paths:
      - '**/package.json'
      - '**/pnpm-lock.yaml'
      - '.github/**/*.yaml'

permissions:
  contents: write

jobs:
  changesets-renovate:
    if: ${{ github.actor == 'renovate[bot]' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5
        with:
          fetch-depth: 2
          ref: ${{ github.head_ref }}
      - name: Setup
        uses: ./.github/actions/setup
      - name: Generate Changeset for Renovate
        # language=bash
        run: |
          SKIP_COMMIT=TRUE pnpx @scaleway/changesets-renovate
          pnpm turbo run build --filter @apitree.cz/prettier-config
          pnpm prettier --write .changeset/**/*.md
      - name: Commit and Push Changeset
        uses: EndBug/add-and-commit@v9.1.4
        with:
          add: '.changeset/**'
          default_author: 'github_actions'
          message: 'chore(renovate): add changeset'
          github_token: ${{ secrets.GITHUB_TOKEN }}
